---
title: "Margin Citation with Locators (Citeproc)"
papersize: us-letter
citation-location: margin
bibliography: borges-refs.bib
citeproc: true
format:
  typst:
    keep-typ: true
_quarto:
  tests:
    typst:
      ensureTypstFileRegexMatches:
        # With citeproc, margin notes contain pre-rendered bibliography text (not #cite calls)
        - ['#note\(', 'Borges.*1941', 'Bifurcan']
        - ['#cite\(<[^>]+>, form: "full"\)']  # Should NOT have native Typst cite calls
      ensurePdfRegexMatches:
        - - 'LOCATOR-MARKER'
          - 'Borges'
          - 'Quain'
          # Citeproc drops "p." prefix - locators appear INLINE after author-date
          # Use year + locator to avoid line-wrap issues with author names
          - '1941, 42\)'           # borges1941library, p. 42
          - '1944, 100'            # borges1944ficciones, pp. 100-115
          - '1936, ch\. 3\)'       # quain1936labyrinth, ch. 3
          - '1980, 200'            # eco1980name, p. 200, fig. 5
        - []
      ensurePdfTextPositions:
        - # Full citation in margin - "Bifurcan" is from borges1941library booktitle
          - subject: "Bifurcan"
            relation: rightOf
            object: "LOCATOR-MARKER"
          # Locator appears inline (left of margin content) - citeproc drops "p." prefix
          - subject: "42"
            relation: leftOf
            object: "Bifurcan"
        - []
      noErrors: default
---

# Testing Citation Locators in Margins

LOCATOR-MARKER: The Library was first described with specific page references [@borges1941library, p. 42].

The expanded edition contains more details [@borges1944ficciones, pp. 100-115].

Chapter-specific references also work [@quain1936labyrinth, ch. 3].

Multiple locator types: see [@eco1980name, p. 200, fig. 5] for the library map.
